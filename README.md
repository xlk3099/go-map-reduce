# gomapreduce
### System Design Problem: Processing 1M books
### use cases
* User wants to get the top 1000 words ordering by the count of occurance
* User wants to get the top 1000 words ordering by appearing in the number of books. 
* Serivce reads the given input of books 
    - generates a sorted key/value pair based on the requirement (count or reverse index)
* Service should have high availibity

### Constrains and assumptions:
1. All the books are stored in one AWS S3 bucket
2. Eacho booksize should be around 10 M, ``so there is not need to split large files``
3. Given a cluster of machines
    - each machine has the permission to read the books (have read permission to the AWS S3 bucket)
    - each machine has the permission to read the intermediate files genearted by other machines.
    - communication latency among the machines and the AWS S3 bucket should be very low.

### High Level Design (mapreduce model), referrence:
[![N|Solid](http://www.marcolotz.com/wp-content/uploads/2014/05/mapreduce.jpg)](https://static.googleusercontent.com/media/research.google.com/en//archive/mapreduce-osdi04.pdf)

Image origin: https://static.googleusercontent.com/media/research.google.com/en//archive/mapreduce-osdi04.pdf


### Core components:
1. **Master**: 
    - Takes the map and reduce functions as well the number of books
    - Serve as a RPC server and waits for workers to register
    - Split the files if necessary (no split requries in this case, since each book is around 10M)
    - Generate tasks, in this case processing one book is a map task and processing the intermediate files generated by map is a reduce task.
    - Map phase: Schedule map tasks and send the task to available workers one by one. Until mapping phase is done.
    - Reduce phase: Schedule and send the reduce tasks to available workers one by one.
    - Merge the intermediate files generated by reduce phase and merge them as one single file.
2. **Worker**:
    - A entity serves as node and can connect to master. Waiting for master's tasks.
    - Do the map and reduce work following master's requirements.
    - Once start doing task, worker is in busy state.
    - Once completed doing a task, worker is in available starte and notify master.
### Implementation: See the code
This map-reduce modle implementation is based on MIT Lab: https://pdos.csail.mit.edu/6.824/labs/lab-1.html
##### The map reduce can be executed in two ways:
**Sequential** :1 master 
```
go run wc.go master sequential x1.txt .. xN.txt
```
**Distributed** : 1 master and n workers
To start a master :
``` 
go run wc.go master localhost:7777 x1.txt .. xN.txt 
```
To start a worker :
```
go run wc.go worker localhost:7777 localhost:7778 
```